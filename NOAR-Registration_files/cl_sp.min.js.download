var actions={},actionList=['textInput','buttonClick','checkboxToggle','dropdownSelect','mouseClick','mouseHover','mouseMove','formSubmit','modalOpen','modalClose','linkClick','radioSelect','recommenderClick','addToCart','elementVisible'].sort();for(var i=0,len=actionList.length;i<len;i++)actions[actionList[i]]=i;function getCookie(name){var re=new RegExp(name+"=([^;]+)");var value=re.exec(document.cookie);return(value!==null)?unescape(value[1]):null;}function deleteCookie(name){document.cookie=name+'=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';}function getParameterByName(name,qs){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(qs);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "));}function compilePatterns(domains){var patterns=[];for(var i=0,len=domains.length;i<len;i++)patterns.push(new RegExp(domains[i]));return patterns;}function resolveCookieDomain(domains){for(i=0,len=domains.length;i<len;i++){domainPattern=new RegExp(domains[i]);if(domainPattern.test(window.location.hostname))return domains[i];}return null;}var CanopyTracker=function(config){var _validVersions=['2.0.0','2.4.3','2.5.3','latest'];var defaults={namespace:'clTrackerv2',migrate:false,debug:false,version:'latest',siteId:'snowplow_test',customerId:'',pageURL:'',trackPV:false,trackPP:false,customerIdParameter:'cluid',customerIdPattern:null,qsSeparator:'?'};this.clNamespace=typeof config.clNamespace!=='undefined'?config.clNamespace:defaults.namespace;this.categoryList=typeof config.categoryList!=='undefined'?config.categoryList:['default'];this.debug=typeof config.debug!=='undefined'?config.debug:defaults.debug;this.actionList=[];for(var i=0,len=actionList.length;i<len;i++)this.actionList.push(actionList[i].replace(/([A-Z])/g,function($1){return "-"+$1.toLowerCase();}));if((typeof config.coreVersion!=='undefined')&&(_validVersions.indexOf(config.coreVersion)>-1))this.coreVersion=config.coreVersion;else this.coreVersion=defaults.version;var siteId=typeof config.siteId!=='undefined'?config.siteId.trim():defaults.siteId,customerId=typeof config.customerId!=='undefined'?config.customerId:defaults.customerId,pageURL=typeof config.pageURL!=='undefined'?config.pageURL:defaults.pageURL,trackPV=typeof config.trackPageView!=='undefined'?config.trackPageView:defaults.trackPV,trackPP=typeof config.trackPageScroll!=='undefined'?config.trackPageScroll:defaults.trackPP,migrate=typeof config.migrate!=='undefined'?config.migrate:defaults.migrate,qsSeparator=typeof config.qsSeparator!=='undefined'?config.qsSeparator:defaults.qsSeparator,customerIdParameter=typeof config.customerIdParameter!=='undefined'?config.customerIdParameter:defaults.customerIdParameter,customerIdPattern=typeof config.customerIdPattern!=='undefined'?config.customerIdPattern:defaults.customerIdPattern,domains=typeof config.domains!=='undefined'?config.domains:[],domainPatterns=compilePatterns(domains),cookieDomain=resolveCookieDomain(domains);var endpoint=window.location.protocol==='https:'?'ingest.canopylabs.com:443':'ingest.canopylabs.com',domainsLength=domainPatterns.length,trackerSettings={encodeBase64:false,appId:siteId,crossDomainLinker:function(link){var i,len;if(domainsLength===0)return false;var parser=document.createElement('a');parser.href=link;if(parser.hostname===window.location.hostname)return false;var domainChecks=[],patt;for(i=0,len=domainsLength;i<len;i++){patt=domainPatterns[i];var isSameDomain=patt.test(window.location.hostname),isCrossDomain=patt.test(parser.hostname);domainChecks.push(isCrossDomain&&!isSameDomain);}return domainChecks.reduceRight(function(x,y){return x||y;});},customDomainUserId:domains.length>0};if(cookieDomain!==null)trackerSettings.cookieDomain=cookieDomain;(function(p,l,o,w,i,n,g){if(!p[i]){p.GlobalSnowplowNamespace=p.GlobalSnowplowNamespace||[];p.GlobalSnowplowNamespace.push(i);p[i]=function(){(p[i].q=p[i].q||[]).push(arguments);};p[i].q=p[i].q||[];n=l.createElement(o);g=l.getElementsByTagName(o)[0];n.async=1;n.src=w;g.parentNode.insertBefore(n,g);}}(window,document,"script","//d1f265j5poqp2.cloudfront.net/"+this.coreVersion+"/sp.js","snowplow"));this._sp=window.snowplow;this._sp('newTracker',this.clNamespace,endpoint,trackerSettings);if(pageURL&&pageURL!=='')this._sp('setCustomUrl:'+this.clNamespace,pageURL);if(customerIdPattern)customerId=new RegExp(customerIdPattern).test(customerId)?customerId:'';if(customerId!=='')this._sp('setUserId:'+this.clNamespace,customerId);else{var currLocation=window.location.href;if(pageURL&&pageURL!=='')currLocation=pageURL;var querystring=currLocation.split(qsSeparator)[1]||'';querystring=querystring.length===0?'':"?"+querystring;this._sp('setUserId:'+this.clNamespace,getParameterByName(customerIdParameter,querystring));}if(trackPP)this._sp('enableActivityTracking:'+this.clNamespace,config.pageScrollSettings.minLength,config.pageScrollSettings.heartbeat);if(trackPV)this._sp('trackPageView:'+this.clNamespace);if(migrate){var cookieName="__clwa";var cookieValue=getCookie(cookieName);if(cookieValue){var anonId='Anon-'+cookieValue;deleteCookie(cookieName);this._sp('trackStructEvent:'+this.clNamespace,'internal','migration','Migration Action',anonId,null);console.log("Migrating user "+anonId);}}};CanopyTracker.prototype={trackEvent:function(argsmap){var categoryName=typeof argsmap.category!=='undefined'?argsmap.category:'default',action=typeof argsmap.action!=='undefined'?argsmap.action:actions.mouseClick,label=typeof argsmap.label!=='undefined'?argsmap.label:null,property=typeof argsmap.property!=='undefined'?argsmap.property:null,value=typeof argsmap.value!=='undefined'?argsmap.value:null;this._sp('trackStructEvent:'+this.clNamespace,categoryName,this.actionList[action],label,property,value);if(this.debug)console.log(categoryName+'|'+this.actionList[action]+'|'+label);},trackUnstructEvent:function(argsmap){var newMap={'schema':argsmap.schema||'','data':argsmap.data||{}};this._sp('trackUnstructEvent:'+this.clNamespace,newMap);},trackEventShort:function(a,b,c,d,e){this._sp('trackStructEvent:'+this.clNamespace,this.categoryList[a],this.actionList[b],c,d,e);if(this.debug)console.log(this.categoryList[a]+'|'+this.actionList[b]+'|'+c+" (l)");},addToCart:function(productId,category,location,quantity){this._sp('trackStructEvent:'+this.clNamespace,category||'abandoned-cart',this.actionList[actions.addToCart],location||"Product Page",productId,quantity||null);},setCustomerId:function(cid){var customerId=cid.toLowerCase();this._sp('setUserId:'+this.clNamespace,customerId);},trackPageView:function(){this._sp('trackPageView:'+this.clNamespace);}};var hasCLT=typeof _clt!=='undefined';var settings={"trackPageScroll":false,"debug":false,"qsSeparator":"?","trackPageView":true,"customerIdParameter":"cluid","customerIdPattern":null,"migrate":false};settings.siteId=(hasCLT&&_clt.hasOwnProperty('siteId')?_clt.siteId:null)||'178cead812';settings.customerId=(hasCLT&&_clt.hasOwnProperty('custId')?_clt.custId:null)||'';settings.domains=(hasCLT&&_clt.hasOwnProperty('domains')?_clt.domains:null)||["www.92y.org","m.92y.org",".92yondemand.org"];settings.pageURL=(hasCLT&&_clt.hasOwnProperty('pageURL')?_clt.pageURL:null)||'';var tracker=new CanopyTracker(settings);$(function(){var CLHaveTracked=[];var sessionSupported=!!window.sessionStorage;if(sessionSupported)if(typeof window.sessionStorage.CLHaveTracked=='undefined')window.sessionStorage.CLHaveTracked=JSON.stringify(CLHaveTracked);else CLHaveTracked=JSON.parse(window.sessionStorage.CLHaveTracked);$('body').on('click','.event-card',function(){var firstEvent=$(this).find('[book-button]').first().attr('perf-no');if(sessionSupported){if($.inArray(firstEvent,CLHaveTracked)==-1){CLHaveTracked.push(firstEvent);window.sessionStorage.CLHaveTracked=JSON.stringify(CLHaveTracked);tracker.trackEvent({category:'register-button',action:actions.buttonClick,property:firstEvent});}}else{console.log("No session supported, tracking "+firstEvent);tracker.trackEvent({category:'register-button',action:actions.buttonClick,property:firstEvent});}});if(window.location.pathname=='/tickets/reservesyos.aspx'||window.location.pathname=='/tickets/ReserveSyos.aspx'){var productId=getParameterByName('performanceNumber',window.location.search);$('body').on('click','#btnReserve',function(){var quantity=$('#cartTable tbody tr').length;if(quantity>0)tracker.addToCart(productId,'add-to-cart','select-own-seats',quantity);});}else{var container=$('#ctl00_primaryContentArea_rpt_perfDates_ctl00_ticketReserve_ticketReserveContainer');if(container.length)container.find('.booking-panel-panel__add-to-cart.btn').on('click',function(){var total=0;container.find('.select.select__num-only.seatSelection').each(function(index){total+=parseInt($(this).val(),10);});if(total>0)tracker.addToCart(container.find('input[name="performanceNumber"]').val(),'add-to-cart','best-available',total);});}});